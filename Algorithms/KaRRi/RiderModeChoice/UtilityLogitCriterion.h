#pragma once

#include "UtilityLogit/Logit.h"
#include "UtilityLogit/utility.h"
#include "UtilityLogit/csvUtils.h"
#include "TransportMode.h"
#include "ModeChoiceInput.h"

namespace karri::mode_choice {

    constexpr char parametersFileContent[] =

#include "UtilityLogit/autogenerated_includable_parameters"
;

using namespace karri::mode_choice::utility_logit;

// Decides whether a rider accepts an assignment based on the request and the assignment finder response.
// Computes simple utility function with default parameters and applies a logit model.
class UtilityLogitCriterion {

public:

    explicit UtilityLogitCriterion() :
            logit(utility_logit::exampleUtilityFunction,
                  options,
                  loadParametersFromCSV<TransportMode, ModeParameters>(std::stringstream(parametersFileContent),
                                                                       stringToTransportMode, fromMap)) {}

    TransportMode apply(ModeChoiceInput input) const {
        std::vector<Alternative<TransportMode>> entries = {
                {TransportMode::Car,  Attributes{input.privateCarTravelTime, 0, 0}},
                {TransportMode::Ped,  Attributes{input.walkTravelTime, 0, 0}},
                {TransportMode::Taxi, Attributes{input.taxiTravelTime, input.taxiWaitTime, input.taxiAccEgrTime}}
        };
        return logit.select(entries);
    }

private:

    static const std::vector<TransportMode> options;
    const Logit<TransportMode, ModeParameters> logit;

};

// out of line definition of static member
const std::vector<TransportMode> UtilityLogitCriterion::options = {TransportMode::Car, TransportMode::Ped,
                                                                   TransportMode::Taxi};

} // karri